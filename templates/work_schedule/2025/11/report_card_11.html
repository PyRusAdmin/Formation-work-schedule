<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –Ω–æ—è–±—Ä—å 2025</title>
    <link rel="stylesheet" href="/static/css/style.css"> <!--   —Å—Ç–∏–ª—å –æ–±—â–∏–π  -->
    <link rel="stylesheet" href="/static/css/report_card_style.css"> <!--   —Å—Ç–∏–ª—å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞  -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<div class="menu">
    <input type="checkbox" id="burger-checkbox" class="burger-checkbox">
    <label for="burger-checkbox" class="burger"></label>
    <div class="overlay"></div> <!-- –î–æ–±–∞–≤–ª–µ–Ω–æ -->
    <ul class="menu-list">
        <li><a href="/" class="menu-item">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></li>
        <li><a href="/entering_vacations" class="menu-item">–í–≤–æ–¥ –æ—Ç–ø—É—Å–∫–æ–≤</a></li>
        <li><a href="/list_employees" class="menu-item">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a></li>
        <li><a href="/report_card" class="menu-item">–ì—Ä–∞—Ñ–∏–∫ –≤—ã—Ö–æ–¥–æ–≤</a></li>
    </ul>
</div>

<body class="p-4 bg-gray-50 min-h-screen">
<h1 class="text-2xl font-bold mb-6 text-center">–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –Ω–æ—è–±—Ä—å 2025</h1>

<!-- Filters -->
<div class="bg-white p-4 rounded-lg shadow-md mb-6">
    <h2 class="text-lg font-semibold mb-4">–§–∏–ª—å—Ç—Ä—ã</h2>
    <div class="grid grid-cols-1 md:grid-cols-7 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700">–ö–°–ü</label>
            <input type="text" id="filter-ksp"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ö–°–ü</label>
            <input type="text" id="filter-name"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <input type="text" id="filter-category"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è</label>
            <input type="text" id="filter-profession"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700">–°—Ç–∞—Ç—É—Å</label>
            <input type="text" id="filter-status"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <!--        –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞-->
        <div>
            <label class="block text-sm font-medium text-gray-700">–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</label>
            <input type="text" id="filter-service-number"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <!--        –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ñ–∞–º–∏–ª–∏–∏-->
        <div>
            <label class="block text-sm font-medium text-gray-700">–§–∞–º–∏–ª–∏—è</label>
            <input type="text" id="filter-surname"
                   class="mt-1 block max-w-xs border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
    </div>
</div>

<!-- –ì–ª–∞–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
<div class="overflow-x-auto overflow-y-auto max-h-[80vh] border rounded-md shadow-sm">
    <table class="min-w-full border-collapse text-sm text-gray-900">
        <thead class="bg-gray-200 sticky top-0 z-10">
        <tr>
            <th class="px-4 py-2 border text-left">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ö–°–ü</th>
            <th class="px-4 py-2 border text-left">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è</th>
            <th class="px-4 py-2 border text-left">–°—Ç–∞—Ç—É—Å</th>
            <th class="px-4 py-2 border text-left">–¢–∞–± ‚Ññ</th>
            <th class="px-4 py-2 border text-left">–§.–ò.–û.</th>
            <th class="px-4 py-2 border text-left">–¢–∞—Ä–∏—Ñ / –û–∫–ª–∞–¥</th>
            <th class="px-2 py-2 border text-center">1</th>
            <th class="px-2 py-2 border text-center">2</th>
            <th class="px-2 py-2 border text-center">3</th>
            <th class="px-2 py-2 border text-center">4</th>
            <th class="px-2 py-2 border text-center">5</th>
            <th class="px-2 py-2 border text-center">6</th>
            <th class="px-2 py-2 border text-center">7</th>
            <th class="px-2 py-2 border text-center">8</th>
            <th class="px-2 py-2 border text-center">9</th>
            <th class="px-2 py-2 border text-center">10</th>
            <th class="px-2 py-2 border text-center">11</th>
            <th class="px-2 py-2 border text-center">12</th>
            <th class="px-2 py-2 border text-center">13</th>
            <th class="px-2 py-2 border text-center">14</th>
            <th class="px-2 py-2 border text-center">15</th>
            <th class="px-2 py-2 border text-center">16</th>
            <th class="px-2 py-2 border text-center">17</th>
            <th class="px-2 py-2 border text-center">18</th>
            <th class="px-2 py-2 border text-center">19</th>
            <th class="px-2 py-2 border text-center">20</th>
            <th class="px-2 py-2 border text-center">21</th>
            <th class="px-2 py-2 border text-center">22</th>
            <th class="px-2 py-2 border text-center">23</th>
            <th class="px-2 py-2 border text-center">24</th>
            <th class="px-2 py-2 border text-center">25</th>
            <th class="px-2 py-2 border text-center">26</th>
            <th class="px-2 py-2 border text-center">27</th>
            <th class="px-2 py-2 border text-center">28</th>
            <th class="px-2 py-2 border text-center">29</th>
            <th class="px-2 py-2 border text-center">30</th>
        </tr>
        </thead>
        <tbody id="table-body"></tbody>
        <!-- Data will be populated by JavaScript -->
        </tbody>
    </table>
</div>

<!-- Edit Mode Controls -->
<div id="edit-controls" class="mt-6 bg-white p-4 rounded-lg shadow-md hidden">
    <h2 class="text-lg font-semibold mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h2>
    <div class="flex space-x-4">
        <button id="save-btn"
                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        </button>
        <button id="cancel-btn"
                class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
            –û—Ç–º–µ–Ω–∏—Ç—å
        </button>
    </div>
    <p class="mt-2 text-sm text-gray-600">
        –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —è—á–µ–π–∫–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞.
    </p>
</div>

<!-- –õ–µ–≥–µ–Ω–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π -->
<div class="mt-6 bg-white p-4 rounded-lg shadow-md">
    <h2 class="text-lg font-semibold mb-4">–õ–µ–≥–µ–Ω–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π</h2>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="flex items-center">
            <div class="w-6 h-6 bg-red-100 border border-red-300 rounded mr-2"></div>
            <span>–ë - –ë–æ–ª—å–Ω–∏—á–Ω—ã–π</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-blue-100 border border-blue-300 rounded mr-2"></div>
            <span>–û - –û—Ç–ø—É—Å–∫</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-green-100 border border-green-300 rounded mr-2"></div>
            <span>1 - –†–∞–±–æ—á–∏–π –¥–µ–Ω—å</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-amber-100 border border-amber-300 rounded mr-2"></div>
            <span>–ü–° - –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-purple-100 border border-purple-300 rounded mr-2"></div>
            <span>–î–û - –î–µ–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–ø—É—Å–∫</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-indigo-100 border border-indigo-300 rounded mr-2"></div>
            <span>–ë–î - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–µ–Ω—å</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-cyan-100 border border-cyan-300 rounded mr-2"></div>
            <span>–ì - –°–ª—É–∂–∏—Ç</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-yellow-100 border border-yellow-300 rounded mr-2"></div>
            <span>–í - –í—ã—Ö–æ–¥–Ω–æ–π</span>
        </div>
        <div class="flex items-center">
            <div class="w-6 h-6 bg-gray-100 border border-gray-300 rounded mr-2"></div>
            <span>- - –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>
        </div>
    </div>
</div>

<script>
    // Initial data based on the provided table
    let data = [];
    let selectedRow = null;
    let editMode = false;
    let openDropdown = null;

    // –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
    const dropdownOptions = [
        { value: '1', label: '–†–∞–±–æ—á–∏–π –¥–µ–Ω—å' },
        { value: '–í', label: '–í—ã—Ö–æ–¥–Ω–æ–π' },
        { value: '–û', label: '–û—Ç–ø—É—Å–∫' },
        { value: '–ë', label: '–ë–æ–ª—å–Ω–∏—á–Ω—ã–π' },
        { value: '-', label: '–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç' },
        { value: '–ì', label: '–°–ª—É–∂–∏—Ç' },
        { value: '–î–û', label: '–î–µ–∫—Ä–µ—Ç' },
        { value: '–ë–î', label: '–ù–µ –ø–æ–ª–Ω–∞—è —Ä–∞–±–æ—á–∞—è –Ω–µ–¥–µ–ª—è' },
        { value: '–ü–°', label: '–ü—Ä–æ—Å—Ç–æ–π' },
    ];

    async function loadData() {
        try {
            const response = await fetch("/data_11"); // –ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É
            if (!response.ok) {
                throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON");
            }
            const jsonData = await response.json();
            data = jsonData;   // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –º–∞—Å—Å–∏–≤ data
            renderTable();     // –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error);
        }
    }

    // –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç —è—á–µ–π–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è
    function getCellColor(value) {
        switch(value) {
            case '–ë':  return 'bg-red-100 text-red-800 border border-red-300';      // –ë–æ–ª—å–Ω–∏—á–Ω—ã–π
            case '–û':  return 'bg-blue-100 text-blue-800 border border-blue-300';   // –û—Ç–ø—É—Å–∫
            case '1':  return 'bg-green-100 text-green-800 border border-green-300'; // –†–∞–±–æ—á–∏–π –¥–µ–Ω—å
            case '–ü–°': return 'bg-amber-100 text-amber-800 border border-amber-300'; // –ü—Ä–æ—Å—Ç–æ–π
            case '–î–û': return 'bg-purple-100 text-purple-800 border border-purple-300'; // –î–µ–∫—Ä–µ—Ç
            case '–ë–î': return 'bg-indigo-100 text-indigo-800 border border-indigo-300'; // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π/–Ω–µ–ø–æ–ª–Ω—ã–π –¥–µ–Ω—å
            case '–ì':  return 'bg-cyan-100 text-cyan-800 border border-cyan-300';   // –°–ª—É–∂–∏—Ç
            case '–í':  return 'bg-yellow-100 text-yellow-800 border border-yellow-300'; // –í—ã—Ö–æ–¥–Ω–æ–π
            case '–≤':  return 'bg-yellow-100 text-yellow-800 border border-yellow-300'; // –ú–∞–ª–µ–Ω—å–∫–∞—è "–≤" (–Ω–∞ –≤—Å—è–∫–∏–π)
            case '-':  return 'bg-gray-100 text-gray-800 border border-gray-300';   // –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            default:   return 'bg-white text-black border border-gray-200';
        }
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü–∞
    function renderTable() {
        const tbody = document.getElementById('table-body');
        const filterKsp = document.getElementById('filter-ksp').value;
        const filterName = document.getElementById('filter-name').value;
        const filterCategory = document.getElementById('filter-category').value;
        const filterProfession = document.getElementById('filter-profession').value;
        const filterStatus = document.getElementById('filter-status').value;
        // –ü–æ–∏—Å–∫ –ø–æ —Ç–∞–±–µ–ª—å–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
        const filterServiceNumber = document.getElementById('filter-service-number').value;
        // –ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏
        const filterSurname = document.getElementById('filter-surname').value;

        // Filter data
        const filteredData = data.filter(row => {
            return (
            (!filterKsp || row.–ö–°–ü.includes(filterKsp)) &&
            (!filterName || row.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.toLowerCase().includes(filterName.toLowerCase())) &&
            (!filterCategory || row.–ö–∞—Ç–µ–≥–æ—Ä–∏—è.toLowerCase().includes(filterCategory.toLowerCase())) &&
            (!filterProfession || row.–ü—Ä–æ—Ñ–µ—Å—Å–∏—è.toLowerCase().includes(filterProfession.toLowerCase())) &&
            (!filterStatus || row.–°—Ç–∞—Ç—É—Å.toLowerCase().includes(filterStatus.toLowerCase())) &&
            (!filterServiceNumber || row.–¢–∞–±.includes(filterServiceNumber)) &&
            (!filterSurname || row.–§–ò–û.toLowerCase().includes(filterSurname.toLowerCase()))
            );
        });

        tbody.innerHTML = '';

        filteredData.forEach((row, rowIndex) => {
            const tr = document.createElement('tr');
            if (selectedRow === rowIndex) {
                tr.classList.add('bg-blue-50');
            }

            tr.innerHTML = `
                <td class="w-2 py-3 whitespace-normal break-words text-sm text-gray-900">${row.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ}</td>
                <td class="w-2 py-3 whitespace-normal break-words text-sm text-gray-900">${row.–ü—Ä–æ—Ñ–µ—Å—Å–∏—è}</td>
                <td class="w-2 py-3 whitespace-normal break-words text-sm text-gray-900">${row.–°—Ç–∞—Ç—É—Å}</td>
                <td class="w-2 py-3 whitespace-nowrap text-sm text-gray-900">${row.–¢–∞–±}</td>
                <td class="w-2 py-3 whitespace-normal break-words text-sm text-gray-900">${row.–§–ò–û}</td>
                <td class="w-2 py-3 whitespace-nowrap text-sm text-gray-900">${row.–¢–∞—Ä–∏—Ñ}</td>
            `;

            row.days.forEach((day, dayIndex) => {
                const td = document.createElement('td');
                td.className = `w-2 py-2 whitespace-nowrap text-sm ${getCellColor(day)} cursor-pointer relative border-2 ${openDropdown?.row === rowIndex && openDropdown?.day === dayIndex ? 'border-blue-500' : 'border-transparent'}`;
                td.innerHTML = `
                    <div class="flex items-center justify-center">
                        <span>${day}</span>
                        <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                `;
                td.onclick = () => handleCellClick(rowIndex, dayIndex);
                tr.appendChild(td);
            });

            tbody.appendChild(tr);
        });
    }

    // Handle cell click
    function handleCellClick(rowIndex, dayIndex) {
        if (!editMode) {
            selectedRow = rowIndex;
            editMode = true;
            document.getElementById('edit-controls').classList.remove('hidden');
        }

        // Close any existing dropdown
        if (openDropdown) {
            const existingDropdown = document.querySelector('.dropdown-menu');
            if (existingDropdown) {
                existingDropdown.remove();
            }
        }

        // Toggle dropdown for this cell
        if (openDropdown?.row === rowIndex && openDropdown?.day === dayIndex) {
            openDropdown = null;
        } else {
            openDropdown = { row: rowIndex, day: dayIndex };
            createDropdownMenu(rowIndex, dayIndex);
        }
    }

    // –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
    function createDropdownMenu(rowIndex, dayIndex) {
        const fixedColumns = 6;
        const cell = document.querySelectorAll('#table-body tr')[rowIndex]?.cells[fixedColumns + dayIndex];
        if (!cell) return;

        // —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä–æ–µ –º–µ–Ω—é
        document.querySelectorAll('.dropdown-menu').forEach(m => m.remove());

        const dropdown = document.createElement('div');
        dropdown.className = 'dropdown-menu absolute';

        dropdownOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'dropdown-item';
            button.textContent = `${option.label} (${option.value})`;
            button.onclick = () => handleOptionSelect(rowIndex, dayIndex, option.value);
            dropdown.appendChild(button);
        });

        cell.appendChild(dropdown);

        // –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        const rect = cell.getBoundingClientRect();
        const menuRect = dropdown.getBoundingClientRect();

        // –µ—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞ ‚Üí —Å–¥–≤–∏–≥–∞–µ–º –≤–ª–µ–≤–æ
        if (rect.right + menuRect.width > window.innerWidth) {
            dropdown.style.left = "auto";
            dropdown.style.right = "0";
        }

        // –µ—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Å–Ω–∏–∑—É ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–≤–µ—Ä—Ö
        if (rect.bottom + menuRect.height > window.innerHeight) {
            dropdown.style.top = "auto";
            dropdown.style.bottom = "100%";
        }
    }


    // Handle option select
    function handleOptionSelect(rowIndex, dayIndex, value) {
        data[rowIndex].days[dayIndex] = value;
        openDropdown = null;
        renderTable();
    }

    // Cancel edit mode
    function handleCancelEdit() {
        editMode = false;
        selectedRow = null;
        openDropdown = null;
        document.getElementById('edit-controls').classList.add('hidden');
        renderTable();
    }

    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    async function handleSave() {
        try {
            const response = await fetch("/data_11", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data) // data = —Ç–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞
            });

            if (!response.ok) {
                throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö!");
            }

            alert("–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ!");
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è!");
        }
    }

    // Event listeners
    document.getElementById('save-btn').onclick = handleSave;
    document.getElementById('cancel-btn').onclick = handleCancelEdit;

    // Filter inputs
    document.getElementById('filter-ksp').oninput = renderTable;
    document.getElementById('filter-name').oninput = renderTable;
    document.getElementById('filter-category').oninput = renderTable;
    document.getElementById('filter-profession').oninput = renderTable;
    document.getElementById('filter-status').oninput = renderTable;
    // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∞–±–µ–ª—å–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
    document.getElementById('filter-service-number').oninput = renderTable;
    // –§–∏–ª—å—Ç—Ä –ø–æ —Ñ–∞–º–∏–ª–∏–∏
    document.getElementById('filter-surname').oninput = renderTable;

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.dropdown-menu') && !e.target.closest('td')) {
            if (openDropdown) {
                const existingDropdown = document.querySelector('.dropdown-menu');
                if (existingDropdown) {
                    existingDropdown.remove();
                }
                openDropdown = null;
            }
        }
    });

    // Initial render
    loadData();
</script>
</body>
</html>