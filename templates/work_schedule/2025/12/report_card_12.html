{% extends "base.html" %}

{% block title %}График работы сотрудников на декабрь 2025{% endblock %}

{% block content %}

<h1 class="text-2xl font-bold mb-6 text-center">График работы сотрудников на декабрь 2025</h1>

<!-- Фильтры -->
<div class="filter-section mb-6">
    <h2>Фильтры</h2>
    <table>
        <tr>
            <th><label>КСП</label><input type="text" id="filter-ksp"></th>
            <th><label>Наименование КСП</label><input type="text" id="filter-name"></th>
            <th><label>Категория</label><input type="text" id="filter-category"></th>
        </tr>
    </table>
    <table>
        <tr>
            <th><label>Профессия</label><input type="text" id="filter-profession"></th>
            <th><label>Статус</label><input type="text" id="filter-status"></th>
            <th><label>Табельный номер</label><input type="text" id="filter-service-number"></th>
        </tr>
    </table>
    <div style="margin-top: 10px;">
        <label>Фамилия</label>
        <input type="text" id="filter-surname" style="width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px;">
    </div>
</div>


<!-- Главная таблица -->
<div class="overflow-x-auto overflow-y-auto max-h-[80vh] border rounded-md shadow-sm">
    <table>
        <thead>
        <tr>
            <th>Наименование КСП</th>
            <th>Профессия</th>
            <th>Статус</th>
            <th>Таб №</th>
            <th>Ф.И.О.</th>
            <th>Тариф / Оклад</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
            <th>18</th>
            <th>19</th>
            <th>20</th>
            <th>21</th>
            <th>22</th>
            <th>23</th>
            <th>24</th>
            <th>25</th>
            <th>26</th>
            <th>27</th>
            <th>28</th>
            <th>29</th>
            <th>30</th>
            <th>31</th>
        </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<!--&lt;!&ndash; Edit Mode Controls &ndash;&gt;-->
<!--<div id="edit-controls" class="mt-6 bg-white p-4 rounded-lg shadow-md hidden">-->
<!--    <h2 class="text-lg font-semibold mb-4">Редактирование записи</h2>-->
<!--    <div class="flex space-x-4">-->
<!--        <button id="save-btn"-->
<!--                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">-->
<!--            Сохранить изменения-->
<!--        </button>-->
<!--        <button id="cancel-btn"-->
<!--                class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">-->
<!--            Отменить-->
<!--        </button>-->
<!--    </div>-->
<!--    <p class="mt-2 text-sm text-gray-600">-->
<!--        Кликните по ячейке в таблице для выбора значения из выпадающего списка.-->
<!--    </p>-->
<!--</div>-->

<!-- Легенда значений -->
<div class="legend-container">
    <h2>Легенда значений</h2>
    <div class="legend-grid">
        <div class="legend-item"><div class="legend-color red"></div>Б - Больничный</div>
        <div class="legend-item"><div class="legend-color blue"></div>О - Отпуск</div>
        <div class="legend-item"><div class="legend-color green"></div>1 - Рабочий день</div>
        <div class="legend-item"><div class="legend-color amber"></div>ПС - Простой предприятия</div>
        <div class="legend-item"><div class="legend-color purple"></div>ДО - Декретный отпуск</div>
        <div class="legend-item"><div class="legend-color indigo"></div>БД - Бесплатный день</div>
        <div class="legend-item"><div class="legend-color cyan"></div>Г - Служит</div>
        <div class="legend-item"><div class="legend-color yellow"></div>В - Выходной</div>
        <div class="legend-item"><div class="legend-color gray"></div>- - Не работает</div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script>
    let data = [];

    // Получить цвет ячейки на основе значения
    function getCellColor(value) {
        switch (value) {
            case 'Б':
                return 'bg-red-100 text-red-800 border border-red-300';
            case 'О':
                return 'bg-blue-100 text-blue-800 border border-blue-300';
            case '1':
                return 'bg-green-100 text-green-800 border border-green-300';
            case 'ПС':
                return 'bg-amber-100 text-amber-800 border border-amber-300';
            case 'ДО':
                return 'bg-purple-100 text-purple-800 border border-purple-300';
            case 'БД':
                return 'bg-indigo-100 text-indigo-800 border border-indigo-300';
            case 'Г':
                return 'bg-cyan-100 text-cyan-800 border border-cyan-300';
            case 'В':
                return 'bg-yellow-100 text-yellow-800 border border-yellow-300';
            case 'в':
                return 'bg-yellow-100 text-yellow-800 border border-yellow-300';
            case '-':
                return 'bg-gray-100 text-gray-800 border border-gray-300';
            default:
                return 'bg-white text-black border border-gray-200';
        }
    }

    // Рендеринг таблицы
    function renderTable() {
        const tbody = document.getElementById('table-body');
        const filterKsp = document.getElementById('filter-ksp').value;
        const filterName = document.getElementById('filter-name').value;
        const filterCategory = document.getElementById('filter-category').value;
        const filterProfession = document.getElementById('filter-profession').value;
        const filterStatus = document.getElementById('filter-status').value;
        const filterServiceNumber = document.getElementById('filter-service-number').value;
        const filterSurname = document.getElementById('filter-surname').value;

        const filteredData = data.filter(row => {
            return (
                (!filterKsp || row.КСП.includes(filterKsp)) &&
                (!filterName || row.Наименование.toLowerCase().includes(filterName.toLowerCase())) &&
                (!filterCategory || row.Категория.toLowerCase().includes(filterCategory.toLowerCase())) &&
                (!filterProfession || row.Профессия.toLowerCase().includes(filterProfession.toLowerCase())) &&
                (!filterStatus || row.Статус.toLowerCase().includes(filterStatus.toLowerCase())) &&
                (!filterServiceNumber || row.Таб.includes(filterServiceNumber)) &&
                (!filterSurname || row.ФИО.toLowerCase().includes(filterSurname.toLowerCase()))
            );
        });

        tbody.innerHTML = '';

        filteredData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td  >${row.Наименование}</td>
                <td  >${row.Профессия}</td>
                <td  >${row.Статус}</td>
                <td  >${row.Таб}</td>
                <td  >${row.ФИО}</td>
                <td  >${row.Тариф}</td>
            `;

            row.days.forEach(day => {
                const td = document.createElement('td');
                td.className = `w-2 py-2 whitespace-nowrap text-sm ${getCellColor(day)} text-center`;
                td.textContent = day;
                tr.appendChild(td);
            });

            tbody.appendChild(tr);
        });
    }

    // Загрузка данных
    async function loadData() {
        try {
            const response = await fetch("/data_12");
            if (!response.ok) throw new Error("Ошибка загрузки данных");
            data = await response.json();
            renderTable();
        } catch (error) {
            console.error("Ошибка при загрузке данных:", error);
            document.getElementById('table-body').innerHTML = `
                <tr><td colspan="36" class="text-center py-4 text-red-600">Ошибка загрузки данных</td></tr>
            `;
        }
    }

    // Фильтрация
    document.getElementById('filter-ksp').oninput = renderTable;
    document.getElementById('filter-name').oninput = renderTable;
    document.getElementById('filter-category').oninput = renderTable;
    document.getElementById('filter-profession').oninput = renderTable;
    document.getElementById('filter-status').oninput = renderTable;
    document.getElementById('filter-service-number').oninput = renderTable;
    document.getElementById('filter-surname').oninput = renderTable;

    // Загрузка при старте
    loadData();
</script>

{% endblock %}
